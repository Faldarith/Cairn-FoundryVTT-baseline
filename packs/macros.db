{"_id":"KqJ2JhHl2tzKHcio","name":"Generate character","permission":{"default":0,"a9Mphu6C9SuGXue4":3},"type":"script","flags":{"core":{"sourceId":"Macro.3zRg0cgONbT8eqmY"}},"scope":"global","command":"async function Create() {\nlet strength = new Roll(\"3d6\").roll().total;\nlet dexterity = new Roll(\"3d6\").roll().total;\nlet will = new Roll(\"3d6\").roll().total;\nlet hp = new Roll(\"1d6\").roll().total;\nlet gold = new Roll(\"3d6\").roll().total;\n// name\nlet maleNamesTable = game.tables.entities.find(t => t.name === \"Male Names\");\nlet femaleNamesTable = game.tables.entities.find(t => t.name === \"Female Names\");\nlet genderRoll = new Roll(\"1d6\").roll().total % 2;\nlet firstName = \"\";\nif (genderRoll == 1) {\n  firstName += maleNamesTable.roll().results[0].text;\n} else {\n  firstName += femaleNamesTable.roll().results[0].text;\n}\nconst surname = game.tables.entities.find(t => t.name === \"Surnames\").roll().results[0].text;\nconst characterName = firstName + \" \" + surname;\n// biography\nconst face = game.tables.entities.find(t => t.name === \"Face\").roll().results[0].text.toLowerCase();\nconst hair = game.tables.entities.find(t => t.name === \"Hair\").roll().results[0].text.toLowerCase();\nconst skin = game.tables.entities.find(t => t.name === \"Skin\").roll().results[0].text.toLowerCase();\nconst physique = game.tables.entities.find(t => t.name === \"Physique\").roll().results[0].text.toLowerCase();\nconst misfortune = game.tables.entities.find(t => t.name === \"Misfortunes\").roll().results[0].text.toLowerCase();\nconst reputation = game.tables.entities.find(t => t.name === \"Reputation\").roll().results[0].text.toLowerCase();\nconst speech = game.tables.entities.find(t => t.name === \"Speech\").roll().results[0].text.toLowerCase();\nconst vice = game.tables.entities.find(t => t.name === \"Vice\").roll().results[0].text.toLowerCase();\nconst virtue = game.tables.entities.find(t => t.name === \"Virtue\").roll().results[0].text.toLowerCase();\nconst clothing = game.tables.entities.find(t => t.name === \"Clothing\").roll().results[0].text.toLowerCase();\nconst characterBackground = game.tables.entities.find(t => t.name === \"Background\").roll().results[0].text;\nlet biography = `I have a <strong>${physique}</strong> physique, <strong>${skin}</strong> skin, <strong>${hair}</strong> hair, and a <strong>${face}</strong> face. I speak in a <strong>${speech}</strong> manner and wear <strong>${clothing}</strong> clothing. I am <strong>${vice}</strong> yet <strong>${virtue}</strong>, and I am generally regarded as <strong>${reputation}</strong>. I have had the misfortune of being <strong>${misfortune}</strong>. I am <strong>36</strong> years old.`;\nlet actorData = {\n  name: characterName,\n  background: characterBackground,\n  biography: biography,\n  hp: { value: hp, max: hp },\n  gold: gold,\n  \"abilities\": {\n    \"STR\": {\n      \"value\": strength,\n      \"max\": strength\n    },\n    \"DEX\": {\n      \"value\": dexterity,\n      \"max\": dexterity\n    },\n    \"WIL\": {\n      \"value\": will,\n      \"max\": will\n    }\n  },\n};\nlet actor = await Actor.create({\n  name: characterName,\n  type: \"character\",\n  img: \"icons/svg/mystery-man.svg\",\n  sort: 12000,\n  data: actorData,\n  token: {},\n  items: [],\n  flags: {}\n});\n\nif(actor){\n  const data = duplicate(game.items.getName(\"Rations\"));\n  data.data.quantity = 3;\n  actor.createOwnedItem(data);\n}\n\nconst torch = game.items.find(i => i.name === \"Torch\");\nactor.createOwnedItem(torch.data);\n\nconst TABLE_NAMES = [\"Armor\", \"Helmets and Shields\", \"Weapons\", \"Expeditionary Gear\", \"Tools\", \"Trinkets\", \"Bonus Item\"];\nlet itemData = TABLE_NAMES.flatMap(n => game.tables.getName(n).roll().results).map(r => game.items.get(r.resultId)?.data).filter(d => d);\nactor.createOwnedItem(itemData);\n};\n\nCreate();","author":"a9Mphu6C9SuGXue4","img":"systems/cairn/tokens/png/gear/person.png","actorIds":[]}
{"_id":"KqJ2JhHl2tzKHcio","name":"Generate character","permission":{"default":0,"a9Mphu6C9SuGXue4":3},"type":"script","flags":{"core":{"sourceId":"Macro.3zRg0cgONbT8eqmY"}},"scope":"global","command":"async function Create() {\nlet strength = new Roll(\"3d6\").roll().total;\nlet dexterity = new Roll(\"3d6\").roll().total;\nlet will = new Roll(\"3d6\").roll().total;\nlet hp = new Roll(\"1d6\").roll().total;\nlet gold = new Roll(\"3d6\").roll().total;\nlet age = new Roll(\"2d20\").roll().total + 10;\n// name\nlet maleNamesTable = game.tables.entities.find(t => t.name === \"Male Names\");\nlet femaleNamesTable = game.tables.entities.find(t => t.name === \"Female Names\");\nlet genderRoll = new Roll(\"1d6\").roll().total % 2;\n\nlet firstName = \"\";\nif (genderRoll == 1) {\n  firstName += maleNamesTable.roll().results[0].text;\n} else {\n  firstName += femaleNamesTable.roll().results[0].text;\n}\nconst surname = game.tables.entities.find(t => t.name === \"Surnames\").roll().results[0].text;\nconst characterName = firstName + \" \" + surname;\n// biography\nconst face = game.tables.entities.find(t => t.name === \"Face\").roll().results[0].text.toLowerCase();\nconst hair = game.tables.entities.find(t => t.name === \"Hair\").roll().results[0].text.toLowerCase();\nconst skin = game.tables.entities.find(t => t.name === \"Skin\").roll().results[0].text.toLowerCase();\nconst physique = game.tables.entities.find(t => t.name === \"Physique\").roll().results[0].text.toLowerCase();\nconst misfortune = game.tables.entities.find(t => t.name === \"Misfortunes\").roll().results[0].text.toLowerCase();\nconst reputation = game.tables.entities.find(t => t.name === \"Reputation\").roll().results[0].text.toLowerCase();\nconst speech = game.tables.entities.find(t => t.name === \"Speech\").roll().results[0].text.toLowerCase();\nconst vice = game.tables.entities.find(t => t.name === \"Vice\").roll().results[0].text.toLowerCase();\nconst virtue = game.tables.entities.find(t => t.name === \"Virtue\").roll().results[0].text.toLowerCase();\nconst clothing = game.tables.entities.find(t => t.name === \"Clothing\").roll().results[0].text.toLowerCase();\nconst characterBackground = game.tables.entities.find(t => t.name === \"Background\").roll().results[0].text;\n\nlet biography = `I have a <strong>${physique}</strong> physique, <strong>${skin}</strong> skin, <strong>${hair}</strong> hair, and a <strong>${face}</strong> face. I speak in a <strong>${speech}</strong> manner and wear <strong>${clothing}</strong> clothing. I am <strong>${vice}</strong> yet <strong>${virtue}</strong>, and I am generally regarded as <strong>${reputation}</strong>. I have had the misfortune of being <strong>${misfortune}</strong>. I am <strong>${age}</strong> years old.`;\n\nlet actorData = {\n  name: characterName,\n  background: characterBackground,\n  biography: biography,\n  hp: { value: hp, max: hp },\n  gold: gold,\n  \"abilities\": {\n    \"STR\": {\n      \"value\": strength,\n      \"max\": strength\n    },\n    \"DEX\": {\n      \"value\": dexterity,\n      \"max\": dexterity\n    },\n    \"WIL\": {\n      \"value\": will,\n      \"max\": will\n    }\n  },\n};\nlet actor = await Actor.create({\n  name: characterName,\n  type: \"character\",\n  img: \"icons/svg/mystery-man.svg\",\n  sort: 12000,\n  data: actorData,\n  token: {},\n  items: [],\n  flags: {}\n});\n\nif(actor){\n  const data = duplicate(game.items.getName(\"Rations\"));\n  data.data.quantity = 3;\n  actor.createOwnedItem(data);\n}\n\nconst torch = game.items.find(i => i.name === \"Torch\");\nactor.createOwnedItem(torch.data);\n\nconst TABLE_NAMES = [\"Armor\", \"Helmets and Shields\", \"Weapons\", \"Expeditionary Gear\", \"Tools\", \"Trinkets\", \"Bonus Item\"];\nlet itemData = TABLE_NAMES.flatMap(n => game.tables.getName(n).roll().results).map(r => game.items.get(r.resultId)?.data).filter(d => d);\nactor.createOwnedItem(itemData);\n};\n\nCreate();","author":"a9Mphu6C9SuGXue4","img":"systems/cairn/tokens/png/gear/person.png","actorIds":[]}
{"_id":"KqJ2JhHl2tzKHcio","name":"Generate character","permission":{"default":0,"a9Mphu6C9SuGXue4":3},"type":"script","flags":{"core":{"sourceId":"Macro.3zRg0cgONbT8eqmY"}},"scope":"global","command":"function formResult(input, output) {\r\n  return `<tr><td style='text-align:left'><b>${input}: <\/b><\/td><td>${output}<\/td><\/tr>`;\r\n}\r\n\r\nasync function Create() {\r\n  let allroll = new Roll(\"3d6[bloodmoon]+3d6[cold]+3d6[force]\").roll();\r\n\r\n  let strresults = allroll.dice[0].results;\r\n  let dexresults = allroll.dice[1].results;\r\n  let wilresults = allroll.dice[2].results;\r\n\r\n  let strength = strresults[0].result + strresults[1].result + strresults[2].result;\r\n  let dexterity = dexresults[0].result + dexresults[1].result + dexresults[2].result;\r\n  let will = wilresults[0].result + wilresults[1].result + wilresults[2].result;\r\n\r\n  let hp = new Roll(\"1d6\").roll().total;\r\n  let gold = new Roll(\"3d6\").roll().total;\r\n  let age = new Roll(\"2d10+10\").roll().total;\r\n  \/\/ name\r\n  let maleNamesTable = game.tables.entities.find(t => t.name === \"Male Names\");\r\n  let femaleNamesTable = game.tables.entities.find(t => t.name === \"Female Names\");\r\n  let genderRoll = new Roll(\"1d6\").roll().total % 2;\r\n  let firstName = \"\";\r\n  if (genderRoll == 1) {\r\n    firstName += maleNamesTable.roll().results[0].text;\r\n  } else {\r\n    firstName += femaleNamesTable.roll().results[0].text;\r\n  }\r\n  const surname = game.tables.entities.find(t => t.name === \"Surnames\").roll().results[0].text;\r\n  const characterName = firstName + \" \" + surname;\r\n  \/\/ biography\r\n  const face = game.tables.entities.find(t => t.name === \"Face\").roll().results[0].text.toLowerCase();\r\n  const hair = game.tables.entities.find(t => t.name === \"Hair\").roll().results[0].text.toLowerCase();\r\n  const skin = game.tables.entities.find(t => t.name === \"Skin\").roll().results[0].text.toLowerCase();\r\n  const physique = game.tables.entities.find(t => t.name === \"Physique\").roll().results[0].text.toLowerCase();\r\n  const misfortune = game.tables.entities.find(t => t.name === \"Misfortunes\").roll().results[0].text.toLowerCase();\r\n  const reputation = game.tables.entities.find(t => t.name === \"Reputation\").roll().results[0].text.toLowerCase();\r\n  const speech = game.tables.entities.find(t => t.name === \"Speech\").roll().results[0].text.toLowerCase();\r\n  const vice = game.tables.entities.find(t => t.name === \"Vice\").roll().results[0].text.toLowerCase();\r\n  const virtue = game.tables.entities.find(t => t.name === \"Virtue\").roll().results[0].text.toLowerCase();\r\n  const clothing = game.tables.entities.find(t => t.name === \"Clothing\").roll().results[0].text.toLowerCase();\r\n  const characterBackground = game.tables.entities.find(t => t.name === \"Background\").roll().results[0].text;\r\n  let biography = `I have a <strong>${physique}<\/strong> physique, <strong>${skin}<\/strong> skin, <strong>${hair}<\/strong> hair, and a <strong>${face}<\/strong> face. I speak in a <strong>${speech}<\/strong> manner and wear <strong>${clothing}<\/strong> clothing. I am <strong>${vice}<\/strong> yet <strong>${virtue}<\/strong>, and I am generally regarded as <strong>${reputation}<\/strong>. I have had the misfortune of being <strong>${misfortune}<\/strong>. I am <strong>${age}<\/strong> years old.`;\r\n  let actorData = {\r\n    name: characterName,\r\n    background: characterBackground,\r\n    biography: biography,\r\n    hp: { value: hp, max: hp },\r\n    gold: gold,\r\n    \"abilities\": {\r\n      \"STR\": {\r\n        \"value\": strength,\r\n        \"max\": strength\r\n      },\r\n      \"DEX\": {\r\n        \"value\": dexterity,\r\n        \"max\": dexterity\r\n      },\r\n      \"WIL\": {\r\n        \"value\": will,\r\n        \"max\": will\r\n      }\r\n    },\r\n  };\r\n  let actor = await Actor.create({\r\n    name: characterName,\r\n    type: \"character\",\r\n    img: \"icons\/svg\/mystery-man.svg\",\r\n    sort: 12000,\r\n    data: actorData,\r\n    token: {},\r\n    items: [],\r\n    flags: {}\r\n  });\r\n\r\n  if (actor) {\r\n    const data = duplicate(game.items.getName(\"Rations\"));\r\n    data.data.quantity = 3;\r\n    actor.createOwnedItem(data);\r\n  }\r\n\r\n\r\n  const torch = game.items.find(i => i.name === \"Torch\");\r\n  actor.createOwnedItem(torch.data);\r\n\r\n  function checkAndGetItemFromSubTable(name) {\r\n    if (SUB_TABLE_NAMES.includes(name)) {\r\n      let subResults = game.tables.getName(name).roll().results;\r\n      \/\/ console.log(\"sub: \" + subResults[0].text);\r\n      return checkAndGetItemFromSubTable(subResults[0].text);\r\n    } else {\r\n      return game.items.find(i => i.name === name);\r\n    }\r\n  }\r\n\r\n  const TABLE_NAMES = [\"Trinkets\", \"Weapons\", \"Helmets and Shields\", \"Armor\", \"Expeditionary Gear\", \"Bonus Item\"];\r\n  const SUB_TABLE_NAMES = [\"Weapons\", \"Simple Weapons\", \"One-Handed Melee\", \"Ranged Weapons\", \"Two-Handed Melee\", \"Tools\", \"Trinkets\", \"Expeditionary Gear\", \"Armor\", \"Spellbooks\"]\r\n\r\n  let itemInsert = \"\";\r\n\r\n  TABLE_NAMES.forEach(tableName => {\r\n    \/\/ console.log(\"table: \" + tableName);\r\n    let results = game.tables.getName(tableName).roll().results;\r\n    \/\/ console.log(\"main: \" + results[0].text);\r\n\r\n    let item = undefined;\r\n\r\n    item = checkAndGetItemFromSubTable(results[0].text);\r\n\r\n    if (item) {\r\n      let itemClicker = \"@Item[\" + item.data.name + \"]\";\r\n      itemInsert += formResult(tableName, itemClicker);\r\n      actor.createOwnedItem(item.data);\r\n    } else {\r\n      itemInsert += formResult(tableName, `None`);\r\n    }\r\n  });\r\n\r\n  function postCharToChat() {\r\n\r\n    let statInsert = formResult(\"Strength\", strength) +\r\n      formResult(\"Dexterity\", dexterity) +\r\n      formResult(\"Will\", will) + `<\/table><table style=\"width:22%\">` +\r\n      formResult(\"HP\", hp) +\r\n      formResult(\"Gold\", gold) + \"<\/table>\";\r\n\r\n    let statsMessage = `<table style=\"width:32%\">${statInsert}<\/table>`;\r\n    let gearMessage = `<table>${itemInsert}<\/table>`;\r\n    let bioMessage = biography;\r\n\r\n    let charInsert = \"@Actor[\" + characterName + \"]\";\r\n\r\n    let chatData = {\r\n      user: game.user._id,\r\n      speaker: ChatMessage.getSpeaker(),\r\n      content: `<h2>${charInsert}<\/h2>` + statsMessage + gearMessage + bioMessage\r\n    };\r\n    ChatMessage.create(chatData, {});\r\n  }\r\n\r\n  if (game.dice3d) {\r\n    game.dice3d.showForRoll(allroll).then(happened => {\r\n      postCharToChat();\r\n\r\n    });\r\n  } else {\r\n    postCharToChat();\r\n  }\r\n\r\n};\r\nCreate();","author":"a9Mphu6C9SuGXue4","img":"systems/cairn/tokens/png/gear/person.png","actorIds":[]}